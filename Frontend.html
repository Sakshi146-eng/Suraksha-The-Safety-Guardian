<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SURAKSHA-THE SAFETY GURADIAN</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
</head>
<body class="bg-gradient-to-br from-indigo-900 to-purple-800 min-h-screen font-sans">
    <!-- Navigation -->
    <nav class="bg-black/30 backdrop-blur-lg text-white shadow-lg fixed w-full z-10">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <i class="fas fa-shield-alt text-2xl text-purple-400"></i>
                <span class="text-xl font-bold bg-gradient-to-r from-purple-400 to-pink-500 bg-clip-text text-transparent">SURAKSHA</span>
            </div>
            <div class="flex items-center space-x-4" id="nav-buttons">
                <button id="login-btn" class="px-4 py-2 rounded-full bg-indigo-600 hover:bg-indigo-700 transition-all transform hover:scale-105">
                    <i class="fas fa-sign-in-alt mr-2"></i>Login
                </button>
                <button id="signup-btn" class="px-4 py-2 rounded-full bg-purple-600 hover:bg-purple-700 transition-all transform hover:scale-105">
                    <i class="fas fa-user-plus mr-2"></i>Sign Up
                </button>
                <button id="logout-btn" class="hidden px-4 py-2 rounded-full bg-red-600 hover:bg-red-700 transition-all transform hover:scale-105">
                    <i class="fas fa-sign-out-alt mr-2"></i>Logout
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content Area -->
    <div class="container mx-auto px-4 pt-20 pb-10">
        <!-- Landing Section -->
        <section id="landing-section" class="flex flex-col md:flex-row items-center justify-between py-16">
            <div class="md:w-1/2 mb-10 md:mb-0">
                <h1 class="text-4xl md:text-5xl font-bold text-white mb-6 leading-tight">Your Personal Safety Companion</h1>
                <p class="text-lg text-purple-200 mb-8">Stay protected with risk detection and emergency alerts.</p>
                <div class="flex flex-wrap gap-4">
                    <button id="get-started-btn" class="px-6 py-3 rounded-full bg-gradient-to-r from-pink-500 to-purple-600 text-white font-bold hover:shadow-lg transform hover:scale-105 transition-all">
                        <i class="fas fa-rocket mr-2"></i>Get Started
                    </button>
                </div>
            </div>
            <div class="md:w-1/2 flex justify-center">
                <div class="w-full max-w-md relative">
                    <div class="absolute inset-0 bg-gradient-to-r from-pink-500 to-purple-600 rounded-3xl blur-xl opacity-50 -z-10 transform rotate-3"></div>
                    <div class="bg-black/40 backdrop-blur-xl border border-white/20 rounded-3xl shadow-2xl overflow-hidden relative z-0">
                        <img src="https://images.unsplash.com/photo-1584824486509-112e4181ff6b?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1470&q=80" 
                            alt="Safety First" class="w-full h-64 object-cover opacity-50">
                        <div class="absolute top-0 left-0 w-full h-full flex items-center justify-center">
                            <div class="bg-black/50 backdrop-blur-sm p-8 rounded-xl">
                                <h3 class="text-2xl font-bold text-white">Feel Safer Instantly</h3>
                                <p class="text-purple-200">Your emergency contacts are just one tap away</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="dashboard-section" class="hidden">
            <!-- Mobile Alert Button - Fixed at Bottom -->
            <div class="fixed bottom-10 inset-x-0 z-20 px-4 flex justify-center">
                <button id="alert-now-btn" class="w-full max-w-xs py-4 bg-gradient-to-r from-red-600 to-pink-600 rounded-full text-white text-lg font-bold flex items-center justify-center shadow-lg transform hover:scale-105 transition-all">
                    <i class="fas fa-exclamation-triangle mr-2 text-xl"></i>ALERT NOW
                </button>
            </div>
            
            <!-- User Info Card -->
            <div class="bg-black/30 backdrop-blur-xl rounded-3xl p-5 mb-6 border border-white/10">
                <div class="flex flex-col">
                    <div class="flex items-center mb-4">
                        <i class="fas fa-user-circle mr-3 text-3xl text-purple-400"></i>
                        <div>
                            <h2 class="text-xl font-bold text-white">Welcome, <span id="user-name" class="bg-gradient-to-r from-purple-400 to-pink-500 bg-clip-text text-transparent">User</span></h2>
                            <p class="text-purple-200 text-sm" id="user-email">user@example.com</p>
                        </div>
                    </div>
                    <div class="flex justify-end">
                        <button id="contacts-btn" class="px-4 py-2 bg-indigo-600 hover:bg-indigo-700 rounded-full text-white font-bold flex items-center text-sm">
                            <i class="fas fa-address-book mr-2"></i>Contacts
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Alert History -->
            <div class="bg-black/30 backdrop-blur-xl rounded-3xl p-5 border border-white/10 mb-20">
                <h3 class="text-lg font-bold text-white mb-4 flex items-center">
                    <i class="fas fa-history mr-2 text-purple-400"></i>Alert History
                </h3>
                <div id="alerts-container" class="space-y-4">
                    <p class="text-purple-200 text-center py-8">No alerts found. Stay safe!</p>
                </div>
            </div>
        </section>
        
        <!-- Features Section -->
        <section id="features-section" class="py-16">
            <h2 class="text-3xl font-bold text-white text-center mb-12">How Safety Guardian Protects You</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div class="bg-black/30 backdrop-blur-xl rounded-3xl p-6 border border-white/10 transform transition-all hover:scale-105 hover:shadow-xl">
                    <div class="w-16 h-16 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-2xl flex items-center justify-center mb-4">
                        <i class="fas fa-shield text-white text-2xl"></i>
                    </div>
                    <h3 class="text-xl font-bold text-white mb-2">Real Time Monitoring</h3>
                    <p class="text-purple-200">Any time any where.</p>
                </div>
                <div class="bg-black/30 backdrop-blur-xl rounded-3xl p-6 border border-white/10 transform transition-all hover:scale-105 hover:shadow-xl">
                    <div class="w-16 h-16 bg-gradient-to-br from-pink-500 to-red-600 rounded-2xl flex items-center justify-center mb-4">
                        <i class="fas fa-location text-white text-2xl"></i>
                    </div>
                    <h3 class="text-xl font-bold text-white mb-2">Google map Tracker</h3>
                    <p class="text-purple-200">Sends the current Location through Email.</p>
                </div>
                <div class="bg-black/30 backdrop-blur-xl rounded-3xl p-6 border border-white/10 transform transition-all hover:scale-105 hover:shadow-xl">
                    <div class="w-16 h-16 bg-gradient-to-br from-green-500 to-teal-600 rounded-2xl flex items-center justify-center mb-4">
                        <i class="fas fa-bell text-white text-2xl"></i>
                    </div>
                    <h3 class="text-xl font-bold text-white mb-2">Instant Alerts</h3>
                    <p class="text-purple-200">Notify emergency contacts and authorities with your location immediately.</p>
                </div>
            </div>
        </section>
    </div>
    <div>
        <footer class="bg-black/30 backdrop-blur-lg text-white py-4 text-center">
            <p>&copy; 2025 Suraksha. All rights reserved.</p>
        </footer>
    </div>

    <!-- Modals -->
    <!-- Login Modal -->
    <div id="login-modal" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 bg-black/60 backdrop-blur-sm"></div>
        <div class="flex items-center justify-center min-h-screen px-4">
            <div class="bg-black/40 backdrop-blur-xl border border-white/20 rounded-3xl w-full max-w-md p-8 relative">
                <button class="close-modal absolute top-4 right-4 text-white/70 hover:text-white">
                    <i class="fas fa-times text-xl"></i>
                </button>
                <div class="text-center mb-6">
                    <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-indigo-600 text-white mb-4">
                        <i class="fas fa-lock text-2xl"></i>
                    </div>
                    <h3 class="text-2xl font-bold text-white">Welcome Back</h3>
                    <p class="text-purple-200">Sign in to access your Safety Guardian</p>
                </div>
                <form id="login-form">
                    <div class="mb-4">
                        <label class="block text-purple-200 mb-2">Email</label>
                        <input type="email" id="login-email" class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-purple-500" required>
                    </div>
                    <div class="mb-6">
                        <label class="block text-purple-200 mb-2">Password</label>
                        <input type="password" id="login-password" class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-purple-500" required>
                    </div>
                    <button type="submit" class="w-full bg-gradient-to-r from-indigo-600 to-purple-600 rounded-lg py-3 text-white font-bold hover:shadow-lg transform hover:scale-105 transition-all">
                        <i class="fas fa-sign-in-alt mr-2"></i>Login
                    </button>
                </form>
                <div class="text-center mt-6">
                    <p class="text-purple-200">Don't have an account? <a href="#" id="go-to-signup" class="text-purple-400 hover:text-purple-300">Sign up</a></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Signup Modal -->
    <div id="signup-modal" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 bg-black/60 backdrop-blur-sm"></div>
        <div class="flex items-center justify-center min-h-screen px-4">
            <div class="bg-black/40 backdrop-blur-xl border border-white/20 rounded-3xl w-full max-w-md p-8 relative">
                <button class="close-modal absolute top-4 right-4 text-white/70 hover:text-white">
                    <i class="fas fa-times text-xl"></i>
                </button>
                <div class="text-center mb-6">
                    <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-purple-600 text-white mb-4">
                        <i class="fas fa-user-plus text-2xl"></i>
                    </div>
                    <h3 class="text-2xl font-bold text-white">Create Account</h3>
                    <p class="text-purple-200">Join Safety Guardian today</p>
                </div>
                <form id="signup-form">
                    <div class="mb-4">
                        <label class="block text-purple-200 mb-2">Full Name</label>
                        <input type="text" id="signup-name" class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-purple-500" required>
                    </div>
                    <div class="mb-4">
                        <label class="block text-purple-200 mb-2">Email</label>
                        <input type="email" id="signup-email" class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-purple-500" required>
                    </div>
                    <div class="mb-6">
                        <label class="block text-purple-200 mb-2">Password</label>
                        <input type="password" id="signup-password" class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-purple-500" required>
                    </div>
                    <button type="submit" class="w-full bg-gradient-to-r from-pink-600 to-purple-600 rounded-lg py-3 text-white font-bold hover:shadow-lg transform hover:scale-105 transition-all">
                        <i class="fas fa-user-plus mr-2"></i>Create Account
                    </button>
                </form>
                <div class="text-center mt-6">
                    <p class="text-purple-200">Already have an account? <a href="#" id="go-to-login" class="text-purple-400 hover:text-purple-300">Login</a></p>
                </div>
            </div>
        </div>
    </div>

  <!-- Replace the existing Contacts Modal with this updated version -->
<div id="contacts-modal" class="fixed inset-0 z-50 hidden">
    <div class="absolute inset-0 bg-black/60 backdrop-blur-sm"></div>
    <div class="flex items-center justify-center min-h-screen px-4">
        <div class="bg-black/40 backdrop-blur-xl border border-white/20 rounded-3xl w-full max-w-md p-8 relative max-h-[90vh] overflow-y-auto">
            <button class="close-modal absolute top-4 right-4 text-white/70 hover:text-white">
                <i class="fas fa-times text-xl"></i>
            </button>
            <div class="text-center mb-6">
                <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-indigo-600 text-white mb-4">
                    <i class="fas fa-address-book text-2xl"></i>
                </div>
                <h3 class="text-2xl font-bold text-white">Emergency Contacts</h3>
                <p class="text-purple-200">Who should we contact in an emergency?</p>
            </div>
            <form id="contacts-form">
                <input type="hidden" id="contacts-user-id">
                <div class="border-b border-white/10 pb-6 mb-6">
                    <h4 class="text-lg font-bold text-white mb-4">Primary Contact</h4>
                    <div class="mb-4">
                        <label class="block text-purple-200 mb-2">Name</label>
                        <input type="text" id="primary-name" class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-purple-500" required>
                    </div>
                    <div class="mb-4">
                        <label class="block text-purple-200 mb-2">Phone</label>
                        <input type="tel" id="primary-phone" class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-purple-500" required>
                    </div>
                    <div class="mb-4">
                        <label class="block text-purple-200 mb-2">Email</label>
                        <input type="email" id="primary-email" class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-purple-500" required>
                    </div>
                </div>
                <div>
                    <h4 class="text-lg font-bold text-white mb-4">Secondary Contact (Optional)</h4>
                    <div class="mb-4">
                        <label class="block text-purple-200 mb-2">Name</label>
                        <input type="text" id="secondary-name" class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-purple-500">
                    </div>
                    <div class="mb-4">
                        <label class="block text-purple-200 mb-2">Phone</label>
                        <input type="tel" id="secondary-phone" class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-purple-500">
                    </div>
                    <div class="mb-6">
                        <label class="block text-purple-200 mb-2">Email</label>
                        <input type="email" id="secondary-email" class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-purple-500">
                    </div>
                </div>
                <button type="submit" class="w-full bg-gradient-to-r from-indigo-600 to-purple-600 rounded-lg py-3 text-white font-bold hover:shadow-lg transform hover:scale-105 transition-all">
                    <i class="fas fa-save mr-2"></i>Save Contacts
                </button>
            </form>
        </div>
    </div>
</div>

    <!-- Alert Modal -->
    <div id="alert-modal" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 bg-black/60 backdrop-blur-sm"></div>
        <div class="flex items-center justify-center min-h-screen px-4">
            <div class="bg-black/40 backdrop-blur-xl border border-white/20 rounded-3xl w-full max-w-md p-8 relative">
                <button class="close-modal absolute top-4 right-4 text-white/70 hover:text-white">
                    <i class="fas fa-times text-xl"></i>
                </button>
                <div class="text-center mb-6">
                    <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-red-600 text-white mb-4">
                        <i class="fas fa-exclamation-triangle text-2xl"></i>
                    </div>
                    <h3 class="text-2xl font-bold text-white">Create Alert</h3>
                    <p class="text-purple-200">Select the risk level to send an alert</p>
                </div>
                <form id="alert-form">
                    <input type="hidden" id="alert-user-id">
                    <div class="mb-6">
                        <label class="block text-purple-200 mb-2">Risk Level</label>
                        <select id="risk-level" class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-purple-500">
                            <option value="risk">Low Risk</option>
                            <option value="risky">Medium Risk</option>
                            <option value="high risk">High Risk</option>
                        </select>
                    </div>
                    <div class="mb-6">
                        <label class="flex items-center">
                            <input type="checkbox" id="include-location" class="form-checkbox h-5 w-5 text-purple-600" checked>
                            <span class="ml-2 text-purple-200">Include my current location</span>
                        </label>
                    </div>
                    <button type="submit" class="w-full bg-gradient-to-r from-red-600 to-pink-600 rounded-lg py-3 text-white font-bold hover:shadow-lg transform hover:scale-105 transition-all">
                        <i class="fas fa-bell mr-2"></i>Send Alert
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        function enhanceMobileExperience() {
    if ($(window).width() < 768) {
        // Increase alert button pulse frequency on mobile
        clearInterval(window.alertPulseInterval);
        window.alertPulseInterval = setInterval(startAlertButtonPulse, 15000);
        
        // Make alert button more noticeable
        $('#alert-now-btn').addClass('shadow-lg');
        
        // Add haptic feedback for alert button (if supported)
        $('#alert-now-btn').on('click', function() {
            if (navigator.vibrate) {
                navigator.vibrate(100);
            }
        });
        
        // Add pull-to-refresh functionality for alert history
        let touchStartY = 0;
        let touchEndY = 0;
        
        $('#alerts-container').on('touchstart', function(e) {
            touchStartY = e.originalEvent.touches[0].clientY;
        });
        
        $('#alerts-container').on('touchend', function(e) {
            touchEndY = e.originalEvent.changedTouches[0].clientY;
            if (touchEndY - touchStartY > 100) {
                // User pulled down
                const userData = localStorage.getItem('safetyGuardianUser');
                if (userData) {
                    loadAlerts(JSON.parse(userData).user_id);
                    showToast('Refreshing alerts...', 'success');
                }
            }
        });
    }
}

// Call this function when the page loads and on resize
$(document).ready(function() {
    enhanceMobileExperience();
    $(window).resize(function() {
        enhanceMobileExperience();
    });
});
        $(document).ready(function() {
            // Check for logged in user
            const userData = localStorage.getItem('safetyGuardianUser');
            if (userData) {
                const user = JSON.parse(userData);
                showLoggedInUI(user);
                loadAlerts(user.user_id);
            }

            // Modal Control
            $('#login-btn').click(function() {
                $('#login-modal').removeClass('hidden');
            });

            $('#signup-btn').click(function() {
                $('#signup-modal').removeClass('hidden');
            });

            $('#get-started-btn').click(function() {
                if (localStorage.getItem('safetyGuardianUser')) {
                    showDashboard();
                } else {
                    $('#signup-modal').removeClass('hidden');
                }
            });

            $('.close-modal').click(function() {
                $(this).closest('.fixed').addClass('hidden');
            });

            $('#go-to-signup').click(function(e) {
                e.preventDefault();
                $('#login-modal').addClass('hidden');
                $('#signup-modal').removeClass('hidden');
            });

            $('#go-to-login').click(function(e) {
                e.preventDefault();
                $('#signup-modal').addClass('hidden');
                $('#login-modal').removeClass('hidden');
            });

            $('#contacts-btn').click(function() {
                const userData = JSON.parse(localStorage.getItem('safetyGuardianUser'));
                $('#contacts-user-id').val(userData.user_id);
                $('#contacts-modal').removeClass('hidden');
            });

            $('#alert-now-btn').click(function() {
                const userData = JSON.parse(localStorage.getItem('safetyGuardianUser'));
                $('#alert-user-id').val(userData.user_id);
                $('#alert-modal').removeClass('hidden');
            });

            $('#logout-btn').click(function() {
                localStorage.removeItem('safetyGuardianUser');
                showLoggedOutUI();
            });

            // Form submissions
            $('#login-form').submit(function(e) {
                e.preventDefault();
                
                const email = $('#login-email').val();
                const password = $('#login-password').val();
                
                $.ajax({
                    type: 'POST',
                    url: '/login',
                    contentType: 'application/json',
                    data: JSON.stringify({ email, password }),
                    success: function(response) {
                        if (response.success) {
                            localStorage.setItem('safetyGuardianUser', JSON.stringify(response));
                            $('#login-modal').addClass('hidden');
                            showLoggedInUI(response);
                            loadAlerts(response.user_id);
                        } else {
                            alert(response.message);
                        }
                    },
                    error: function(err) {
                        console.error('Login error:', err);
                        alert('Login failed. Please try again.');
                    }
                });
            });

            $('#signup-form').submit(function(e) {
                e.preventDefault();
                
                const name = $('#signup-name').val();
                const email = $('#signup-email').val();
                const password = $('#signup-password').val();
                
                $.ajax({
                    type: 'POST',
                    url: '/register',
                    contentType: 'application/json',
                    data: JSON.stringify({ name, email, password }),
                    success: function(response) {
                        if (response.success) {
                            // Auto login after successful signup
                            $.ajax({
                                type: 'POST',
                                url: '/login',
                                contentType: 'application/json',
                                data: JSON.stringify({ email, password }),
                                success: function(loginResponse) {
                                    if (loginResponse.success) {
                                        localStorage.setItem('safetyGuardianUser', JSON.stringify(loginResponse));
                                        $('#signup-modal').addClass('hidden');
                                        showLoggedInUI(loginResponse);
                                    } else {
                                        alert('Registration successful. Please login.');
                                        $('#signup-modal').addClass('hidden');
                                        $('#login-modal').removeClass('hidden');
                                    }
                                }
                            });
                        } else {
                            alert(response.message);
                        }
                    },
                    error: function(err) {
                        console.error('Registration error:', err);
                        alert('Registration failed. Please try again.');
                    }
                });
            });

            $('#contacts-form').submit(function(e) {
                e.preventDefault();
                
                const user_id = $('#contacts-user-id').val();
                const primaryName = $('#primary-name').val();
                const primaryPhone = $('#primary-phone').val();
                const primaryEmail = $('#primary-email').val();
                const secondaryName = $('#secondary-name').val();
                const secondaryPhone = $('#secondary-phone').val();
                const secondaryEmail = $('#secondary-email').val();
                
                $.ajax({
                    type: 'POST',
                    url: '/contacts',
                    contentType: 'application/json',
                    data: JSON.stringify({
                        user_id,
                        primaryName,
                        primaryPhone,
                        primaryEmail,
                        secondaryName,
                        secondaryPhone,
                        secondaryEmail
                    }),
                    success: function(response) {
                        if (response.success) {
                            $('#contacts-modal').addClass('hidden');
                            alert('Emergency contacts saved successfully!');
                        } else {
                            alert(response.message);
                        }
                    },
                    error: function(err) {
                        console.error('Saving contacts error:', err);
                        alert('Failed to save contacts. Please try again.');
                    }
                });
            });

            $('#alert-form').submit(function(e) {
                e.preventDefault();
                
                const user_id = $('#alert-user-id').val();
                const risk_level = $('#risk-level').val();
                const includeLocation = $('#include-location').is(':checked');
                
                // Get current location if checkbox is checked
                if (includeLocation && navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(
                        function(position) {
                            createAlert(user_id, risk_level, {
                                latitude: position.coords.latitude,
                                longitude: position.coords.longitude
                            });
                        },
                        function(error) {
                            console.error('Geolocation error:', error);
                            createAlert(user_id, risk_level, {
                                latitude: 0,
                                longitude: 0
                            });
                        }
                    );
                } else {
                    createAlert(user_id, risk_level, {
                        latitude: 0,
                        longitude: 0
                    });
                }
            });

            function createAlert(user_id, risk_level, location) {
                $.ajax({
                    type: 'POST',
                    url: '/api/alert',
                    contentType: 'application/json',
                    data: JSON.stringify({
                        user_id,
                        risk_level,
                        location
                    }),
                    success: function(response) {
                        if (response.success) {
                            $('#alert-modal').addClass('hidden');
                            alert('Alert sent successfully!');
                            loadAlerts(user_id);
                        } else {
                            alert(response.message);
                        }
                    },
                    error: function(err) {
                        console.error('Alert error:', err);
                        alert('Failed to send alert. Please try again.');
                    }
                });
            }

            function loadAlerts(user_id) {
    $.ajax({
        type: 'GET',
        url: `/api/alerts?user_id=${user_id}`,
        success: function(response) {
            if (response.success && response.alerts && response.alerts.length > 0) {
                renderAlerts(response.alerts);
            }
        },
        error: function(err) {
            console.error('Error loading alerts:', err);
        }
    });
}

            function renderAlerts(alerts) {
    const container = $('#alerts-container');
    container.empty();
    
    if (alerts.length === 0) {
        container.html('<p class="text-purple-200 text-center py-8">No alerts found. Stay safe!</p>');
        return;
    }
    
    alerts.forEach(alert => {
        const alertClass = alert.risk_level === 'high risk' ? 'border-red-500' : 
                          alert.risk_level === 'risky' ? 'border-orange-500' : 'border-yellow-500';
        
        const alertIcon = alert.risk_level === 'high risk' ? 'exclamation-triangle' : 
                         alert.risk_level === 'risky' ? 'exclamation-circle' : 'info-circle';
        
        const alertColor = alert.risk_level === 'high risk' ? 'text-red-500' : 
                          alert.risk_level === 'risky' ? 'text-orange-500' : 'text-yellow-500';
        
        const date = new Date(alert.created_at).toLocaleString();
        
        const alertItem = `
            <div class="bg-black/20 backdrop-blur-md rounded-xl p-4 border-l-4 ${alertClass}">
                <div class="flex justify-between items-start">
                    <div class="flex items-center">
                        <i class="fas fa-${alertIcon} ${alertColor} text-xl mr-3"></i>
                        <div>
                            <h4 class="font-bold text-white">${capitalizeFirstLetter(alert.risk_level)} Alert</h4>
                            
                        </div>
                    </div>
                    <div class="bg-black/30 px-3 py-1 rounded-full text-xs text-purple-200">
                        ${alert.status || 'Sent'}
                    </div>
                </div>
                ${alert.location && alert.location.latitude !== 0 ? 
                `<div class="mt-3 text-sm text-purple-200">
                    <i class="fas fa-map-marker-alt mr-1"></i> Location shared
                </div>` : ''}
            </div>
        `;
        
        container.append(alertItem);
    });
}

function capitalizeFirstLetter(string) {
    return string.charAt(0).toUpperCase() + string.slice(1);
}

function showLoggedInUI(user) {
    // Update navbar
    $('#login-btn, #signup-btn').addClass('hidden');
    $('#logout-btn').removeClass('hidden');
    
    // Update dashboard
    $('#user-name').text(user.name || 'User');
    $('#user-email').text(user.email || 'user@example.com');
    
    // Show dashboard, hide landing
    $('#landing-section, #features-section').addClass('hidden');
    $('#dashboard-section').removeClass('hidden');
    
    // Load user contacts if available
    if (user.user_id) {
        loadUserContacts(user.user_id);
    }
}

function showLoggedOutUI() {
    // Update navbar
    $('#logout-btn').addClass('hidden');
    $('#login-btn, #signup-btn').removeClass('hidden');
    
    // Show landing, hide dashboard
    $('#dashboard-section').addClass('hidden');
    $('#landing-section, #features-section').removeClass('hidden');
    
    // Clear forms
    $('#login-form, #signup-form, #contacts-form, #alert-form').trigger('reset');
}

function loadUserContacts(user_id) {
    $.ajax({
        type: 'GET',
        url: `/api/contacts?user_id=${user_id}`,
        success: function(response) {
            if (response.success && response.contacts) {
                // Fill contacts form with existing data
                $('#primary-name').val(response.contacts.primaryName || '');
                $('#primary-phone').val(response.contacts.primaryPhone || '');
                $('#primary-email').val(response.contacts.primaryEmail || '');
                $('#secondary-name').val(response.contacts.secondaryName || '');
                $('#secondary-phone').val(response.contacts.secondaryPhone || '');
                $('#secondary-email').val(response.contacts.secondaryEmail || '');
            }
        },
        error: function(err) {
            console.error('Error loading contacts:', err);
        }
    });
}

// Handle mobile navigation
$(window).resize(function() {
    responsiveUI();
});

function responsiveUI() {
    if ($(window).width() < 768) {
        // Mobile adjustments
        $('.container').addClass('px-2').removeClass('px-4');
    } else {
        // Desktop adjustments
        $('.container').removeClass('px-2').addClass('px-4');
    }
}

// Initialize responsive UI
responsiveUI();

// Add pulse animation to alert button for better visibility
function startAlertButtonPulse() {
    $('#alert-now-btn').addClass('animate-pulse');
    setTimeout(function() {
        $('#alert-now-btn').removeClass('animate-pulse');
    }, 2000);
}

// Periodically pulse the alert button to draw attention
setInterval(startAlertButtonPulse, 30000);

// Add offline/online detection
window.addEventListener('online', function() {
    showToast('You are back online', 'success');
});

window.addEventListener('offline', function() {
    showToast('You are offline. Some features may be limited.', 'error');
});

function showToast(message, type) {
    // Remove any existing toast
    $('.toast-message').remove();
    
    const toastClass = type === 'error' ? 'bg-red-600' : 'bg-green-600';
    const icon = type === 'error' ? 'exclamation-circle' : 'check-circle';
    
    const toast = `
        <div class="toast-message fixed bottom-4 left-1/2 transform -translate-x-1/2 ${toastClass} text-white px-4 py-2 rounded-lg shadow-lg z-50 flex items-center">
            <i class="fas fa-${icon} mr-2"></i>${message}
        </div>
    `;
    
    $('body').append(toast);
    
    // Auto remove after 3 seconds
    setTimeout(function() {
        $('.toast-message').fadeOut(300, function() {
            $(this).remove();
        });
    }, 3000);
}

// Auto-refresh tokens if needed
function refreshTokenIfNeeded() {
    const userData = localStorage.getItem('safetyGuardianUser');
    if (userData) {
        const user = JSON.parse(userData);
        const tokenExpiry = user.token_expiry;
        
        if (tokenExpiry && new Date(tokenExpiry) < new Date()) {
            // Token expired, refresh it
            $.ajax({
                type: 'POST',
                url: '/api/refresh-token',
                contentType: 'application/json',
                data: JSON.stringify({ refresh_token: user.refresh_token }),
                success: function(response) {
                    if (response.success) {
                        // Update stored user data with new tokens
                        user.token = response.token;
                        user.token_expiry = response.token_expiry;
                        user.refresh_token = response.refresh_token;
                        
                        localStorage.setItem('safetyGuardianUser', JSON.stringify(user));
                    } else {
                        // Force logout if refresh fails
                        localStorage.removeItem('safetyGuardianUser');
                        showLoggedOutUI();
                        showToast('Session expired. Please login again.', 'error');
                    }
                },
                error: function() {
                    // Force logout if refresh fails
                    localStorage.removeItem('safetyGuardianUser');
                    showLoggedOutUI();
                    showToast('Session expired. Please login again.', 'error');
                }
            });
        }
    }
}

// Check token every minute
setInterval(refreshTokenIfNeeded, 60000);

// Check for saved credentials and auto-login
function checkSavedCredentials() {
    const savedCredentials = localStorage.getItem('savedCredentials');
    if (savedCredentials) {
        const credentials = JSON.parse(savedCredentials);
        
        $('#login-email').val(credentials.email);
        // Don't pre-fill password for security reasons
        
        // Optionally auto-login
        // $('#login-form').submit();
    }
}

// Save credentials option
$('#login-form').append(`
    <div class="mt-4">
        <label class="flex items-center">
            <input type="checkbox" id="save-credentials" class="form-checkbox h-4 w-4 text-purple-600">
            <span class="ml-2 text-purple-200 text-sm">Remember my email</span>
        </label>
    </div>
`);

// Modify login form submission to save credentials if checked
const originalLoginSubmit = $('#login-form').submit;
$('#login-form').submit(function(e) {
    e.preventDefault();
    
    const email = $('#login-email').val();
    const password = $('#login-password').val();
    const saveCredentials = $('#save-credentials').is(':checked');
    
    if (saveCredentials) {
        localStorage.setItem('savedCredentials', JSON.stringify({
            email: email
        }));
    } else {
        localStorage.removeItem('savedCredentials');
    }
    
    $.ajax({
        type: 'POST',
        url: '/login',
        contentType: 'application/json',
        data: JSON.stringify({ email, password }),
        success: function(response) {
            if (response.success) {
                localStorage.setItem('safetyGuardianUser', JSON.stringify(response));
                $('#login-modal').addClass('hidden');
                showLoggedInUI(response);
                loadAlerts(response.user_id);
                showToast('Login successful!', 'success');
            } else {
                showToast(response.message || 'Login failed', 'error');
            }
        },
        error: function(err) {
            console.error('Login error:', err);
            showToast('Login failed. Please try again.', 'error');
        }
    });
});

// Initialize
checkSavedCredentials();

});
</script>
</body>
</html>
